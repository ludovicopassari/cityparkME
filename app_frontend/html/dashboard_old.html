<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Smart Parking</title>
    <!-- Link per Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
    <script>
        // Caricamento della navbar
        fetch('navbar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
            })
            .catch(error => console.error('Errore nel caricamento della navbar:', error));
    </script>
</head>


<body>

    <!-- Placeholder per la navbar -->
    <div id="navbar"></div>

    


    <!-- Script per Bootstrap JS e dipendenze -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    
</body>
</html>

<script>
        function decodeJWT(token) {
            const parts = token.split('.');
            
            if (parts.length !== 3) {
                throw new Error('Token JWT non valido');
            }

            // Decodifica l'header e il payload (Base64 URL-safe)
            const header = JSON.parse(atob(parts[0]));
            const payload = JSON.parse(atob(parts[1]));

            return { header, payload };
            }

        // Recupero del token JWT
        const token = localStorage.getItem('jwt_token');
        if (!token) {
            console.log("Token non trovato. Redireziona al login.");
            window.location.href = '/login.html'; // Redireziona al login
            
        }

        const decoded = decodeJWT(token);
        const currentTime = Math.floor(Date.now() / 1000); // Timestamp corrente in secondi
        console.log(currentTime);
        console.log(decoded.payload.exp);
        if (decoded.payload.exp < currentTime){
            window.location.href = '/login.html'; // Redireziona al login
            sessionStorage.removeItem('jwt_token');
        }

      
        console.log(decoded);
    </script>